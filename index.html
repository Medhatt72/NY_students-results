<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مدرسة الشهيد مجدى النبراوى - نتائج الطلبة</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .school-header {
            text-align: center;
            margin: 30px 0;
            padding: 15px;
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .school-header h1 {
            font-size: 28px;
            margin: 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .search-box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        input[type="text"] {
            padding: 10px;
            margin: 10px 0;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .certificate {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            display: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        
        .student-info {
            margin-bottom: 20px;
            line-height: 2;
            font-size: 18px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 16px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }
        
        th {
            background-color: #f8f9fa;
            min-width: 150px;
        }
        
        .warning {
            color: #dc3545;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="school-header">
          <p> إدارة مشتول السوق التعليمية - محافظة الشرقية </p>
            <h1>مدرسة الشهيد مجدى النبراوى تعليم اساسى</h1>
           
        </div>

        <div class="search-box">
            <h2>نظام استعلام نتائج الطلاب</h2>
            <input type="text" id="searchInput" placeholder="ادخل الرقم القومي (14 رقمًا)" maxlength="14">
            <div id="message" class="warning"></div>
        </div>

        <div class="certificate" id="certificate">
            <div class="header">
                <h1>شهادة تحصيل درجات</h1>
                <h3>العام الدراسي 2024/2025</h3>
            </div>
            
            <div class="student-info">
                <!-- تم تعديل هذا القسم لضمان ظهور الاسم -->
                <p><strong>اسم الطالب:</strong> <span id="studentName" class="student-data">---</span></p>
                <p><strong>الرقم القومي:</strong> <span id="nationalId" class="student-data">---</span></p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>المادة الدراسية</th>
                        <th>الدرجة</th>
                    </tr>
                </thead>
                <tbody id="resultsTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // إعدادات يجب تعديلها حسب مستودعك
        const GITHUB_USERNAME = 'Medhatt72';
        const REPO_NAME = 'NY_students-results  ';
        const EXCEL_FILE_NAME = 'studentData.xlsx';

        // روابط المواد الدراسية
        const subjects = [
           'اسم الطالب',
            'اللغة العربية والخط العربي',
            'اللغة الانجليزية',
            'الدراسات الاجتماعية',
            'رياضيات',
            'العلوم',
            'مجموع كلي',
            'نشاط اختياري 1',
            'نشاط اختياري 2',
            'التربية الفنية',
            'الكمبيوتر وتكنولوجيا المعلومات',
            'التربية الدينية',
            'التربية الرياضية',
            'التربية الموسيقية',
            'الصف'
        ];

        // متغيرات النظام
        let studentData = [];
        const excelURL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${EXCEL_FILE_NAME}`;

        // تحميل بيانات الإكسل
        async function loadExcelData() {
            try {
                const response = await fetch(excelURL);
                if (!response.ok) throw new Error('فشل في تحميل الملف');
                
                const data = await response.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'array' });
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                studentData = XLSX.utils.sheet_to_json(worksheet);
                
                if (studentData.length === 0) throw new Error('الملف لا يحتوي على بيانات');
                if (!studentData[0].hasOwnProperty('الرقم القومى')) throw new Error('العمود "الرقم القومى" غير موجود');
                
                document.getElementById('message').className = 'success';
                document.getElementById('message').textContent = '✓ النظام جاهز للبحث';
            } catch (error) {
                document.getElementById('message').className = 'warning';
                document.getElementById('message').textContent = `⚠ خطأ: ${error.message}`;
            }
        }

        // البحث بالرقم القومي
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchValue = e.target.value.trim();
            const message = document.getElementById('message');
            message.textContent = '';

            if (searchValue.length === 0) {
                document.getElementById('certificate').style.display = 'none';
                return;
            }

            if (searchValue.length !== 14 || isNaN(searchValue)) {
                message.className = 'warning';
                message.textContent = 'الرجاء إدخال رقم قومي صحيح (14 رقمًا)';
                return;
            }

            const result = studentData.find(student => 
                student['الرقم القومى'].toString() === searchValue
            );

            const certificate = document.getElementById('certificate');
            
            if (result) {
                displayResult(result);
                certificate.style.display = 'block';
            } else {
                certificate.style.display = 'none';
                message.className = 'warning';
                message.textContent = 'لا توجد نتائج مطابقة للرقم المدخل';
            }
        });

        // عرض النتائج
        function displayResult(data) {
            document.getElementById('studentName').textContent = data['اسم الطالب'] || '---';
            document.getElementById('nationalId').textContent = data['الرقم القومى'] || '---';

            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';
            
            subjects.forEach(subject => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${subject}</td>
                    <td>${data[subject] || '---'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // بدء التشغيل عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', () => {
            loadExcelData();
            document.getElementById('searchInput').focus();
        });
    </script>
</body>
</html>
